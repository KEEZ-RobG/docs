"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[9044],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>u});var n=t(7294);function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){i(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,i=function(e,a){if(null==e)return{};var t,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(i[t]=e[t]);return i}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=n.createContext({}),p=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},d=function(e){var a=p(e.components);return n.createElement(s.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(t),u=i,f=m["".concat(s,".").concat(u)]||m[u]||c[u]||r;return t?n.createElement(f,o(o({ref:a},d),{},{components:t})):n.createElement(f,o({ref:a},d))}));function u(e,a){var t=arguments,i=a&&a.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=m;var l={};for(var s in a)hasOwnProperty.call(a,s)&&(l[s]=a[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=t[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},8871:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var n=t(3117),i=(t(7294),t(3905));const r={sidebar_position:1,title:"Universal Profile"},o="Deploying a Universal Profile",l={unversionedId:"tools/lsp-factoryjs/deployment/universal-profile",id:"tools/lsp-factoryjs/deployment/universal-profile",title:"Universal Profile",description:"LSPFactory allows you to quickly deploy and configure a Universal Profile consisting of an LSP0 ERC725 Account, an LSP6 Key Manager, and an LSP1-UniversalReceiver smart contract:",source:"@site/docs/tools/lsp-factoryjs/deployment/universal-profile.md",sourceDirName:"tools/lsp-factoryjs/deployment",slug:"/tools/lsp-factoryjs/deployment/universal-profile",permalink:"/tools/lsp-factoryjs/deployment/universal-profile",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/tools/lsp-factoryjs/deployment/universal-profile.md",tags:[],version:"current",lastUpdatedAt:1658794893,formattedLastUpdatedAt:"Jul 26, 2022",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Universal Profile"},sidebar:"toolsSidebar",previous:{title:"Getting Started",permalink:"/tools/lsp-factoryjs/getting-started"},next:{title:"Digital Asset",permalink:"/tools/lsp-factoryjs/deployment/digital-asset"}},s={},p=[{value:"Profile Properties",id:"profile-properties",level:2},{value:"Controller Addresses",id:"controller-addresses",level:3},{value:"Adding LSP3 Metadata",id:"adding-lsp3-metadata",level:3},{value:"Setting Images in LSP3MetaData",id:"setting-images-in-lsp3metadata",level:3},{value:"Pre-uploaded Images",id:"pre-uploaded-images",level:4},{value:"Setting an Avatar in LSP3MetaData",id:"setting-an-avatar-in-lsp3metadata",level:3},{value:"Using the Javascript File object",id:"using-the-javascript-file-object",level:4},{value:"Uploading LSP3 metadata to IPFS",id:"uploading-lsp3-metadata-to-ipfs",level:3},{value:"Deployment Configuration",id:"deployment-configuration",level:2},{value:"Universal Receiver Delegate Proxy Deployment",id:"universal-receiver-delegate-proxy-deployment",level:4},{value:"Contract Versions",id:"contract-versions",level:3},{value:"Deploying Custom Bytecode",id:"deploying-custom-bytecode",level:3},{value:"IPFS Upload Options",id:"ipfs-upload-options",level:3},{value:"Reactive Deployment",id:"reactive-deployment",level:3}],d={toc:p};function c(e){let{components:a,...t}=e;return(0,i.kt)("wrapper",(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"deploying-a-universal-profile"},"Deploying a Universal Profile"),(0,i.kt)("p",null,"LSPFactory allows you to quickly deploy and configure a Universal Profile consisting of an ",(0,i.kt)("a",{parentName:"p",href:"../../../standards/universal-profile/lsp0-erc725account"},"LSP0 ERC725 Account"),", an ",(0,i.kt)("a",{parentName:"p",href:"../../../standards/universal-profile/lsp6-key-manager"},"LSP6 Key Manager"),", and an ",(0,i.kt)("a",{parentName:"p",href:"/standards/generic-standards/lsp1-universal-receiver"},"LSP1-UniversalReceiver")," smart contract:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"await lspFactory.UniversalProfile.deploy(profileProperties [, options]);\n")),(0,i.kt)("p",null,"This will deploy the following contracts:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"../../../standards/universal-profile/lsp0-erc725account"},"LSP0 ERC725 Account")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"../../../standards/universal-profile/lsp6-key-manager"},"LSP6 Key Manager")),(0,i.kt)("li",{parentName:"ul"},"And link to a pre-deployed ",(0,i.kt)("a",{parentName:"li",href:"/standards/generic-standards/lsp1-universal-receiver"},"LSP1 Universal Receiver"))),(0,i.kt)("p",null,"After, it will:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"upload metadata to IPFS and set the ",(0,i.kt)("a",{parentName:"li",href:"../../../standards/universal-profile/lsp3-universal-profile-metadata"},"LSP3 Universal Profile")," metadata,"),(0,i.kt)("li",{parentName:"ul"},"attach the Universal Receiver Delegate to the ERC725 Account,"),(0,i.kt)("li",{parentName:"ul"},"set the Key Manager as the owner of the ERC725 Account, and"),(0,i.kt)("li",{parentName:"ul"},"set all ",(0,i.kt)("a",{parentName:"li",href:"../../../standards/universal-profile/lsp6-key-manager#-types-of-permissions"},"permissions")," for the ",(0,i.kt)("inlineCode",{parentName:"li"},"controllerAddresses")," except ",(0,i.kt)("inlineCode",{parentName:"li"},"DELEGATECALL"),".")),(0,i.kt)("p",null,"These smart contracts linked with some ",(0,i.kt)("a",{parentName:"p",href:"../../../standards/universal-profile/lsp3-universal-profile-metadata"},"LSP3 Universal Profile Metadata")," form a Universal Profile. The metadata is the 'face' of your profile and contains information such as your name, description, and profile image."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The deployment key passed to LSPFactory will be given ",(0,i.kt)("inlineCode",{parentName:"p"},"CHANGEOWNER")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"CHANGEPERMISSIONS")," ",(0,i.kt)("a",{parentName:"p",href:"../../../standards/universal-profile/lsp6-key-manager#-types-of-permissions"},"LSP6 permissions")," in order to carry out the Universal Profile deployment."),(0,i.kt)("p",{parentName:"admonition"},"These permisisons are revoked as the final step of deployment. It is important this step is completed correctly to avoid security risks.")),(0,i.kt)("h2",{id:"profile-properties"},"Profile Properties"),(0,i.kt)("p",null,"Inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"profileProperties")," object, you can set profile configuration options such as the controller addresses and LSP3 metadata."),(0,i.kt)("h3",{id:"controller-addresses"},"Controller Addresses"),(0,i.kt)("p",null,"You can set the addresses which should be able to control your Universal Profile initially by passing in the ",(0,i.kt)("inlineCode",{parentName:"p"},"controllerAddresses"),". The addresses that were passed here will be given all LSP6 KeyManager permissions except ",(0,i.kt)("inlineCode",{parentName:"p"},"DELEGATECALL")," to ",(0,i.kt)("a",{parentName:"p",href:"https://solidity-by-example.org/hacks/delegatecall/"},"prevent accidental misuse"),". If your controller keys require ",(0,i.kt)("inlineCode",{parentName:"p"},"DELEGATECALL"),", you can ",(0,i.kt)("a",{parentName:"p",href:"/guides/key-manager/give-permissions"},"change the permission after deployment"),"."),(0,i.kt)("p",null,"The property ",(0,i.kt)("inlineCode",{parentName:"p"},"controllerAddresses")," can be filled with addresses of externally owned accounts (EOAs) or another smart contract that can call the ",(0,i.kt)("inlineCode",{parentName:"p"},"execute(calldata)")," function on the KeyManager."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"await lspFactory.UniversalProfile.deploy({\n  controllerAddresses: [\n    '0x7Ab53a0C861fb955050A8DA109eEeA5E61fd8Aa4',\n    '0x56fE4E7dc2bc0b6397E4609B07b4293482E3F72B',\n  ],\n});\n")),(0,i.kt)("h3",{id:"adding-lsp3-metadata"},"Adding LSP3 Metadata"),(0,i.kt)("p",null,"When deploying a Universal Profile with LSPFactory, you can specify your Universal Profile metadata using the ",(0,i.kt)("inlineCode",{parentName:"p"},"lsp3Profile")," key in the ",(0,i.kt)("inlineCode",{parentName:"p"},"profileProperties")," object:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"await lspFactory.UniversalProfile.deploy({\n  controllerAddresses: ['0x...'],\n  lsp3Profile: myUniversalProfileData,\n});\n")),(0,i.kt)("admonition",{title:"Info",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Profile Metadata can be passed as either a JSON object containing the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-3-UniversalProfile-Metadata.md#lsp3profile"},"LSP3Metadata")," you want to upload or a URL of your previously uploaded metadata.")),(0,i.kt)("p",null,"If an LSP3MetaData object is passed, LSPFactory will process and upload your metadata to IPFS."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"See ",(0,i.kt)("a",{parentName:"p",href:"././universal-profile#ipfs-upload-options"},"Upload Options")," for details on how to specify a custom IPFS gateway.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title='Uploading an LSP3 metadata automatically'",title:"'Uploading",an:!0,LSP3:!0,metadata:!0,"automatically'":!0},"await lspFactory.UniversalProfile.deploy({\n    controllerAddresses: ['0x...'],\n    lsp3Profile: {\n      name: 'My-Cool-Profile',\n      description: 'My cool Universal Profile',\n      tags: ['public-profile'],\n      links: [{\n        title: 'My Website',\n        url: 'www.my-website.com'\n      }],\n      ...\n    }\n  });\n};\n")),(0,i.kt)("p",null,"LSP3 Metadata can also be passed with the ",(0,i.kt)("inlineCode",{parentName:"p"},"LSP3Profile")," key:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title='Uploading an LSP3 metadata automatically'",title:"'Uploading",an:!0,LSP3:!0,metadata:!0,"automatically'":!0},"await lspFactory.UniversalProfile.deploy({\n    controllerAddresses: ['0x...'],\n    lsp3Profile: {\n      LSP3Profile: {\n        name: 'My-Cool-Profile',\n        description: 'My cool Universal Profile',\n        tags: ['public-profile'],\n        links: [{\n          title: 'My Website',\n          url: 'www.my-website.com'\n        }],\n        ...\n      }\n    }\n  });\n};\n")),(0,i.kt)("p",null,"The following two examples will download the JSON file before hashing it and generating the proper ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-2-ERC725YJSONSchema.md#JSONURL"},"JSONURL")," value."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title='Providing a previously uploaded LSP3 metadata IPFS URL'",title:"'Providing",a:!0,previously:!0,uploaded:!0,LSP3:!0,metadata:!0,IPFS:!0,"URL'":!0},"await lspFactory.UniversalProfile.deploy({\n    controllerAddresses: ['0x...'],\n    lsp3Profile: 'ipfs://QmQ7Wq4y2gWiuzB4a4Wd6UiidKNpzCJRpgzFqQwzyq6SsV'\n  });\n};\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title='Providing a previously uploaded LSP3 metadata URL'",title:"'Providing",a:!0,previously:!0,uploaded:!0,LSP3:!0,metadata:!0,"URL'":!0},"await lspFactory.UniversalProfile.deploy({\n    controllerAddresses: ['0x...'],\n    lsp3Profile: 'https://mycoolserver.com/myProfile.json'\n  });\n};\n")),(0,i.kt)("p",null,"You can also provide the JSON file yourself to generate the hash value:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title='Providing an already uploaded LSP3 metadata  url and JSON file itself'",title:"'Providing",an:!0,already:!0,uploaded:!0,LSP3:!0,metadata:!0,"":!0,url:!0,and:!0,JSON:!0,file:!0,"itself'":!0},"await lspFactory.UniversalProfile.deploy({\n  controllerAddresses: ['0x...'],\n  lsp3Profile: {\n    json: lsp3ProfileJson,\n    url: 'https://mycoolserver.com/myProfile.json',\n  },\n});\n")),(0,i.kt)("p",null,"Or you can provide the hash value and then uploaded file URL:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title='Providing an already uploaded LSP3 metadata  url and hash values'",title:"'Providing",an:!0,already:!0,uploaded:!0,LSP3:!0,metadata:!0,"":!0,url:!0,and:!0,hash:!0,"values'":!0},"await lspFactory.UniversalProfile.deploy({\n  controllerAddresses: ['0x...'],\n  lsp3Profile: {\n    hash: '0xfdafad027ecfe57eb4ad047b938805d1dec209d6e9f960fc320d7b9b11cbed14',\n    hashFunction: 'keccak256(utf8)',\n    url: 'https://mycoolserver.com/file.json',\n  },\n});\n")),(0,i.kt)("h3",{id:"setting-images-in-lsp3metadata"},"Setting Images in LSP3MetaData"),(0,i.kt)("p",null,"The properies ",(0,i.kt)("inlineCode",{parentName:"p"},"profileImage")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"backgroundImage")," can be passed inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"lsp3Profile")," object. These can be given as an object containing previously uploaded image Metadata, a Javascript ",(0,i.kt)("inlineCode",{parentName:"p"},"File")," object if used client-side."),(0,i.kt)("h4",{id:"pre-uploaded-images"},"Pre-uploaded Images"),(0,i.kt)("p",null,"An LSP3 Profile requires the properties ",(0,i.kt)("inlineCode",{parentName:"p"},"profileImage")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"backgroundImage")," to be uploaded in multiple sizes so that interfaces can choose which one to load for better loading performance."),(0,i.kt)("p",null,"If you already have an image uploaded to IPFS in multiple sizes, you can pass image metadata inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"lsp3Profile")," object when deploying a Profile."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Both ",(0,i.kt)("inlineCode",{parentName:"p"},"profileImage")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"backgroundImage")," take an array, where each element is the metadata of different image size.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title='Setting LSP3 metadata to be uploaded with profile and background images'",title:"'Setting",LSP3:!0,metadata:!0,to:!0,be:!0,uploaded:!0,with:!0,profile:!0,and:!0,background:!0,"images'":!0},"const myUniversalProfileData = {\n  name: 'My Universal Profile',\n  description: 'My cool Universal Profile',\n  profileImage: [\n    {\n      width: 500,\n      height: 500,\n      hashFunction: 'keccak256(bytes)',\n      hash: '0xfdafad027ecfe57eb4ad044b938805d1dec209d6e9f960fc320d7b9b11cced14', // bytes32 hex string of the image hash\n      url: 'ipfs://QmPLqMFDxiUgYAom3Zg4SiwoxDaFcZpHXpCmiDzxrajSGp',\n    },\n    ... // Multiple image sizes should be included\n  ],\n  backgroundImage: [\n    {\n      width: 500,\n      height: 500,\n      hashFunction: 'keccak256(bytes)',\n      hash: '0xfdafad027ecfe57eb4ad047b938805d1dec209d6e9f960fc320d7b9b11cbed14', // bytes32 hex string of the image hash\n      url: 'ipfs://QmPLqMFHxiUDYAom3Zg4SiwoxDaFcZpHXpAmiDzxrtjSGp',\n    },\n    ... // Multiple image sizes should be included\n  ],\n};\n\nawait lspFactory.UniversalProfile.deploy({\n    controllerAddresses: ['0x...'],\n    lsp3Profile: myUniversalProfileData\n  });\n};\n")),(0,i.kt)("h3",{id:"setting-an-avatar-in-lsp3metadata"},"Setting an Avatar in LSP3MetaData"),(0,i.kt)("p",null,"An avatar can be set by passing the ",(0,i.kt)("inlineCode",{parentName:"p"},"avatar")," property to the ",(0,i.kt)("inlineCode",{parentName:"p"},"lsp3Profile")," object."),(0,i.kt)("p",null,"An avatar can be passed as an array where each element is a different file format of the same avatar. Each file format can be passed as a ",(0,i.kt)("inlineCode",{parentName:"p"},"File")," object, or asset metadata object according to the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-2-ERC725YJSONSchema.md#Array"},"LSP2 ERC725Y JSON Schema standard"),"."),(0,i.kt)("p",null,"If an avatar file is passed as a ",(0,i.kt)("inlineCode",{parentName:"p"},"File")," object, the file will uploaded to IPFS, converted to the correct asset metadata format and added to the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.lukso.tech/standards/universal-profile/lsp3-universal-profile-metadata"},"LSP3 Profile Metadata")," Json."),(0,i.kt)("p",null,"Avatar files passed as a metadata objects will be set directly on the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.lukso.tech/standards/universal-profile/lsp3-universal-profile-metadata"},"LSP3 Profile Metadata")," Json."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title='Setting LSP3 metadata to be uploaded with an avatar with two formats'",title:"'Setting",LSP3:!0,metadata:!0,to:!0,be:!0,uploaded:!0,with:!0,an:!0,avatar:!0,two:!0,"formats'":!0},"<input type=\"file\" id=\"avatar\">\n\n<script>\n  const myLocalAvatar = document.getElementById('avatar').files[0];\n\n  const myUniversalProfileData = {\n    name: 'My Universal Profile',\n    description: 'My cool Universal Profile',\n    asset: [\n        myLocalAvatar,\n        {\n          hashFunction: 'keccak256(bytes)',\n          hash: '0x5f3dbd89cde4dde36241c501203b67a93b89908063f5516535136bc25f712e11',\n          url: 'ipfs://QmWkAki4mLq2c9hsbKs4HFCaZdpUX1jLKKBb5y8YMATkak',\n          fileType: 'image/obj',\n        },\n      ]\n  };\n\n  await lspFactory.UniversalProfile.deploy({\n    controllerAddresses: ['0x...'],\n    lsp3Profile: myUniversalProfileData\n  });\n\n<script/>\n")),(0,i.kt)("h4",{id:"using-the-javascript-file-object"},"Using the Javascript File object"),(0,i.kt)("p",null,"Javascript offers a ",(0,i.kt)("inlineCode",{parentName:"p"},"File")," object for easy handling of files inside a browser. Developers can pass these to ",(0,i.kt)("inlineCode",{parentName:"p"},"profileImage")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"backgroundImage")," fields to allow easy drag and drop of images from a user interface."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Javascript's ",(0,i.kt)("inlineCode",{parentName:"p"},"File")," object is only available when using javascript in the browser. If using LSPFactory in a Node environment, image metadata should be passed.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'<input type="file" id="input">\n\n<script>\n    const myLocalFile = document.getElementById(\'input\').files[0];\n\n    const myUniversalProfileData = {\n        name: "My Universal Profile",\n        description: "My cool Universal Profile",\n        profileImage: myLocalFile,\n        backgroundImage: myLocalFile,\n        tags: [\'Fashion\', \'Design\'],\n        links: [{\n          title: "My Website",\n          url: "www.my-website.com"\n        }],\n    };\n\n    await lspFactory.UniversalProfile.deploy({\n      controllerAddresses: [\'0x...\'],\n      lsp3Profile: myUniversalProfileData\n    });\n};\n<script/>\n')),(0,i.kt)("p",null,"LSPFactory will create five resized versions of the passed image, with max sizes of ",(0,i.kt)("inlineCode",{parentName:"p"},"1800x1800"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"1024x1024"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"640x640"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"320x320"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"180x180"),". These resized images will be set inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"LSP3Metadata")," and attached to the ",(0,i.kt)("inlineCode",{parentName:"p"},"ERC725Account")," contract."),(0,i.kt)("h3",{id:"uploading-lsp3-metadata-to-ipfs"},"Uploading LSP3 metadata to IPFS"),(0,i.kt)("p",null,"You can upload your LSP3 metadata before deploying a Universal Profile using the ",(0,i.kt)("inlineCode",{parentName:"p"},"uploadMetaData()")," method. The function uses the same ",(0,i.kt)("a",{parentName:"p",href:"./universal-profile#adding-lsp3-metadata"},(0,i.kt)("inlineCode",{parentName:"a"},"lsp3Profile")," object schema")," defined above when deploying a Universal Profile. Returns an object containing the IPFS upload location of your metadata and your ",(0,i.kt)("inlineCode",{parentName:"p"},"lsp3Metdata")," as a javascript object."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"await myLSPFactory.UniversalProfile.uploadMetaData(lsp3Profile [, options]);\n")),(0,i.kt)("p",null,"To upload using a custom IPFS gateway, pass the ",(0,i.kt)("inlineCode",{parentName:"p"},"options")," object. The field is the same ",(0,i.kt)("inlineCode",{parentName:"p"},"options")," object used when deploying a Universal Profile. ",(0,i.kt)("a",{parentName:"p",href:"./universal-profile#ipfs-upload-options"},"Read more"),"."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"uploadMetaData()")," function is available as a static or non-static method to be called without instantiating an ",(0,i.kt)("inlineCode",{parentName:"p"},"LSPFactory")," object."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Calling uploadMetaData on an LSPFactory instance"',title:'"Calling',uploadMetaData:!0,on:!0,an:!0,LSPFactory:!0,'instance"':!0},"await myLSPFactory.UniversalProfile.uploadMetaData(myLSP3MetaData);\n\n/**\n{\n  hash: '0x1234...',\n  hashFunction: 'keccak256(utf8)',\n  url: 'https://ipfs.lukso.network/ipfs/QmPzUfdKhY6vfcLNDnitwKanpm5GqjYSmw9todNVmi4bqy',\n  json: {\n    LSP3Profile: {\n      name: \"My Universal Profile\",\n      description: \"My Cool Universal Profile\",\n      ...\n    }\n  }\n}\n*/\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Calling uploadMetaData on the uninstantiated class"',title:'"Calling',uploadMetaData:!0,on:!0,the:!0,uninstantiated:!0,'class"':!0},"await UniversalProfile.uploadMetaData(myLSP3MetaData);\n\n> // same as above\n")),(0,i.kt)("h2",{id:"deployment-configuration"},"Deployment Configuration"),(0,i.kt)("p",null,"A Universal Profile is composed of three smart contracts. ",(0,i.kt)("a",{parentName:"p",href:"../../../standards/universal-profile/lsp0-erc725account"},"LSP0 ERC725 Account"),", ",(0,i.kt)("a",{parentName:"p",href:"../../../standards/universal-profile/lsp6-key-manager"},"LSP6 Key Manager"),", and ",(0,i.kt)("a",{parentName:"p",href:"/standards/generic-standards/lsp1-universal-receiver"},"LSP1-UniversalReceiver"),".\nWhen deploying a Universal Profile, you can configure how these contracts should be deployed inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"options")," object."),(0,i.kt)("p",null,"Under the ",(0,i.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/options#version"},(0,i.kt)("inlineCode",{parentName:"a"},"version"))," key, developers can pass a ",(0,i.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/options#version"},"version number"),", ",(0,i.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/options#deploying-custom-bytecode"},"custom bytecode")," or a ",(0,i.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/options#custom-base-contract-address"},"base contract address")," to be used during deployment. By setting the ",(0,i.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/options#deploy-proxy"},(0,i.kt)("inlineCode",{parentName:"a"},"deployProxy"))," parameter developers can specify whether the contract should be deployed using proxy deployment."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"deployProxy")," defaults to true for ",(0,i.kt)("inlineCode",{parentName:"p"},"ERC725Account")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"KeyManager")," and false for ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate"),".\nRead more about configuring proxy deployment and contract versioning ",(0,i.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/options"},"here"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"await lspFactory.UniversalProfile.deploy({...}, {\n  LSP0ERC725Account: {\n    version: '0.4.1', // Version number\n    deployProxy: true\n  },\n  LSP1UniversalReceiverDelegate: {\n    version: '0x...', // Custom bytecode\n    deployProxy: false\n  },\n  LSP6KeyManager: {\n    version: '0x6c1F3Ed2F99054C88897e2f32187ef15c62dC560', // Base contract address\n    deployProxy: true\n  }\n})\n")),(0,i.kt)("h4",{id:"universal-receiver-delegate-proxy-deployment"},"Universal Receiver Delegate Proxy Deployment"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate")," is a logic contract that writes to the Universal Profile when it receives some asset. This operation is not specific to any particular Universal Profile, so developers can use the same ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate")," contract for multiple different Universal Profile deployments."),(0,i.kt)("p",null,"By default, no Universal Receiver Delegate contract will be deployed. Instead LSPFactory will use the latest available version of the ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate")," version stored in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/tools-lsp-factory/blob/main/src/versions.json"},"version file"),". This address is used directly on the Universal Profile and is given the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.lukso.tech/standards/universal-profile/lsp6-key-manager#permissions"},(0,i.kt)("inlineCode",{parentName:"a"},"SETDATA")," LSP6 permission"),"."),(0,i.kt)("p",null,"Reusing the ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate")," address means that no ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate")," contract needs to be deployed when deploying a Universal Profile which further reduces the gas cost of Universal Profile deployment."),(0,i.kt)("p",null,"To specify that your ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate")," contract should use proxy deployment, set the property ",(0,i.kt)("inlineCode",{parentName:"p"},"deployProxy")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),". If no base contract address is specified in the ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," parameter a new ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate")," base contract will be deployed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"lspFactory.UniversalProfile.deploy({...}, {\n    LSP1UniversalReceiverDelegate: {\n        deployProxy: true,\n        version: '0x00b1d454Eb5d917253FD6cb4D5560dEC30b0960c',\n    },\n})\n")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"UniversalReceiverDelegate")," contract does not use proxy deployment by default. If an address is passed to the ",(0,i.kt)("inlineCode",{parentName:"p"},"LSP1UniversalReceiverDelegate")," ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," parameter and ",(0,i.kt)("inlineCode",{parentName:"p"},"deployProxy")," is not set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", LSPFactory will set the provided address directly on the ERC725Account as the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/LIPs/blob/main/LSPs/LSP-0-ERC725Account.md#lsp1universalreceiverdelegate"},"LSP1UniversalReceiverDelegate key")," and the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.lukso.tech/standards/universal-profile/lsp6-key-manager#permissions"},(0,i.kt)("inlineCode",{parentName:"a"},"SETDATA")," LSP6 permission"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Using a custom UniversalReceiverDelegate address"',title:'"Using',a:!0,custom:!0,UniversalReceiverDelegate:!0,'address"':!0},"lspFactory.UniversalProfile.deploy({...}, {\n    LSP1UniversalReceiverDelegate: {\n        version: '0x00b1d454Eb5d917253FD6cb4D5560dEC30b0960c',\n        deployProxy: false\n    },\n})\n")),(0,i.kt)("h3",{id:"contract-versions"},"Contract Versions"),(0,i.kt)("p",null,"LSPFactory stores the addresses of different base contract versions ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lukso-network/tools-lsp-factory/blob/main/src/versions.json"},"internally"),". By specifying a ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," number, developers can specify which base contract implementation should be used during deployment."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," of all three contracts can be set at once by passing the global version parameter. The version can also be set per contract, which will take precedence over the global parameter."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Deploying a Universal Profile with all contracts set to version 0.5.0"',title:'"Deploying',a:!0,Universal:!0,Profile:!0,with:!0,all:!0,contracts:!0,set:!0,to:!0,version:!0,'0.5.0"':!0},"await lspFactory.UniversalProfile.deploy({...}, {\n    version: '0.5.0'\n});\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Deploying a Universal Profile at version 0.5.0, with a KeyManager set to version to 0.4.0"',title:'"Deploying',a:!0,Universal:!0,Profile:!0,at:!0,version:!0,"0.5.0,":!0,with:!0,KeyManager:!0,set:!0,to:!0,'0.4.0"':!0},"await lspFactory.UniversalProfile.deploy({...}, {\n    version: '0.5.0',\n    LSP6KeyManager: {\n      version: '0.4.0'\n    }\n});\n")),(0,i.kt)("h3",{id:"deploying-custom-bytecode"},"Deploying Custom Bytecode"),(0,i.kt)("p",null,"When deploying a Universal Profile, you can use your custom contract implementation by passing the compiled creation bytecode of a contract you have written as the ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," parameter. The ",(0,i.kt)("inlineCode",{parentName:"p"},"bytecode")," parameter can be the instantiation bytecode of a custom contract implementation you have written according to your use case. The implementation must meet the relevant LSP standard requirements."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"The custom bytecode will be deployed and used as part of the Universal Profile. Contracts deployed from custom bytecode will not use any proxy contract deployment.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Deploying a Universal Profile with a custom KeyManager implementation"',title:'"Deploying',a:!0,Universal:!0,Profile:!0,with:!0,custom:!0,KeyManager:!0,'implementation"':!0},"lspFactory.UniversalProfile.deploy({...}, {\n    LSP6KeyManager: {\n      version: '0x...'\n    }\n});\n")),(0,i.kt)("h3",{id:"ipfs-upload-options"},"IPFS Upload Options"),(0,i.kt)("p",null,"You can specify how you want your profile metadata to be uploaded while passing the options object. Here you can set the IPFS gateway where you want the profile's metadata to be uploaded."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"The procedure takes a URL string or an object as defined by the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ipfs/js-ipfs/tree/master/packages/ipfs-http-client#createoptions"},"IPFS-HTTP Client")," library which is used internally to interact with the specified IPFS node.")),(0,i.kt)("p",null,"If a URL is passed and no port is specified, the standard 5001 port will be used."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Passing ipfsGateway URL"',title:'"Passing',ipfsGateway:!0,'URL"':!0},"lspFactory.UniversalProfile.deploy({...}, {\n  ipfsGateway: 'https://ipfs.infura.io:5001'\n})\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Passing ipfsGateway URL string with port set"',title:'"Passing',ipfsGateway:!0,URL:!0,string:!0,with:!0,port:!0,'set"':!0},"lspFactory.UniversalProfile.deploy({...}, {\n  ipfsGateway: 'https://ipfs.infura.io' // No port set. Port 5001 will be used\n})\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Passing ipfsGateway options as an object"',title:'"Passing',ipfsGateway:!0,options:!0,as:!0,an:!0,'object"':!0},"lspFactory.UniversalProfile.deploy({...}, {\n  ipfsGateway: {\n    host: 'ipfs.infura.io',\n    port: 5001,\n    protocol: 'https',\n  }\n})\n")),(0,i.kt)("p",null,"If the ",(0,i.kt)("inlineCode",{parentName:"p"},"ipfsGateway")," parameter is provided, it will override the ",(0,i.kt)("inlineCode",{parentName:"p"},"ipfsGateway")," object passed during the instantiation of the LSPFactory for this function call only."),(0,i.kt)("h3",{id:"reactive-deployment"},"Reactive Deployment"),(0,i.kt)("p",null,"LSPFactory emits events for each step of the deployment process. These events can be hooked into by passing the ",(0,i.kt)("inlineCode",{parentName:"p"},"onDeployEvents")," object inside of the ",(0,i.kt)("inlineCode",{parentName:"p"},"options")," object."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"onDeployEvents")," object takes three callback handler parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"next")," will be called once for every deployment event that is fired."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"complete")," will be called once after deployment is finished with the completed contract deployment details."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"error")," will be called once if an error is thrown during deployment.")),(0,i.kt)("p",null,"This enables LSPFactory to be used for certain reactive behaviors. For example, to give better feedback to users during deployment from a user interface such as a loading bar, or display live updates with the details and addresses of contracts as they are deployed."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"complete")," callback will be called with the same contracts object which is returned when the ",(0,i.kt)("inlineCode",{parentName:"p"},"deploy")," function is resolved.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Reactive deployment of a Universal Profile"',title:'"Reactive',deployment:!0,of:!0,a:!0,Universal:!0,'Profile"':!0},"const contracts = await lspFactory.UniversalProfile.deploy({...}, {\n  onDeployEvents: {\n    next: (deploymentEvent) => {\n      console.log(deploymentEvent);\n    },\n    error: (error) => {\n      console.error(error);\n    },\n    complete: (contracts) => {\n      console.log('Universal Profile deployment completed');\n      console.log(contracts);\n    },\n  }\n});\n\n/**\n{\n  type: 'PROXY_DEPLOYMENT',\n  contractName: 'LSP0ERC725Account',\n  status: 'PENDING',\n  transaction: {\n    ...\n  }\n}\n{\n  type: 'PROXY_DEPLOYMENT',\n  contractName: 'LSP0ERC725Account',\n  status: 'COMPLETE',\n  contractAddress: '0xa7b2ab323cD2504689637A0b503262A337ab87d6',\n  receipt: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'initialize(address)',\n  status: 'PENDING',\n  transaction: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'initialize(address)',\n  status: 'COMPLETE',\n  receipt: {\n    ...\n  }\n}\n{\n  type: 'PROXY_DEPLOYMENT',\n  contractName: 'LSP6KeyManager',\n  status: 'PENDING',\n  transaction: {\n    ...\n  }\n}\n{\n  type: 'PROXY_DEPLOYMENT',\n  contractName: 'LSP6KeyManager',\n  status: 'COMPLETE',\n  contractAddress: '0x8fE3f0fd1bc2aCDA6cf3712Cd9C7858B8195DC8E',\n  receipt: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP6KeyManager',\n  functionName: 'initialize(address)',\n  status: 'PENDING',\n  transaction: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP6KeyManager',\n  functionName: 'initialize(address)',\n  status: 'COMPLETE',\n  receipt: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'setData(bytes32[],bytes[])',\n  status: 'PENDING',\n  transaction: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'setData(bytes32[],bytes[])',\n  status: 'COMPLETE',\n  receipt: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  status: 'PENDING',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'transferOwnership(address)',\n  transaction: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'transferOwnership(address)',\n  status: 'COMPLETE',\n  receipt: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'claimOwnership()',\n  status: 'PENDING',\n  transaction: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'claimOwnership()',\n  status: 'COMPLETE',\n  receipt: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'setData(bytes32,bytes)',\n  status: 'PENDING',\n  transaction: {\n    ...\n  }\n}\n{\n  type: 'TRANSACTION',\n  contractName: 'LSP0ERC725Account',\n  functionName: 'setData(bytes32,bytes)',\n  status: 'COMPLETE',\n  receipt: {\n    ...\n  }\n}\nUniversal Profile deployment completed\n{\n  LSP0ERC725Account: {\n    address: '0xa7b2ab323cD2504689637A0b503262A337ab87d6',\n    receipt: {\n      ...\n    }\n  },\n  LSP6KeyManager: {\n    address: '0x8fE3f0fd1bc2aCDA6cf3712Cd9C7858B8195DC8E',\n    receipt: {\n      ...\n    }\n  }\n}\n*/\n\n")))}c.isMDXComponent=!0}}]);