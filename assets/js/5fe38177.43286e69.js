"use strict";(self.webpackChunklukso_docs=self.webpackChunklukso_docs||[]).push([[8250],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||p[m]||s;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var c=2;c<s;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294),r=n(4334);const s="tabItem_Ymn6";function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(s,i),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(3117),r=n(7294),s=n(4334),i=n(2389),o=n(7392),l=n(7094),c=n(2466);const d="tabList__CuJ",p="tabItem_LNqP";function u(e){var t,n;const{lazy:i,block:u,defaultValue:m,values:h,groupId:y,className:f}=e,v=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),k=null!=h?h:v.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),g=(0,o.l)(k,((e,t)=>e.value===t.value));if(g.length>0)throw new Error('Docusaurus error: Duplicate values "'+g.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const b=null===m?m:null!=(t=null!=m?m:null==(n=v.find((e=>e.props.default)))?void 0:n.props.value)?t:v[0].props.value;if(null!==b&&!k.some((e=>e.value===b)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+k.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:w,setTabGroupChoices:P}=(0,l.U)(),[N,A]=(0,r.useState)(b),E=[],{blockElementScrollPositionUntilNextRender:j}=(0,c.o5)();if(null!=y){const e=w[y];null!=e&&e!==N&&k.some((t=>t.value===e))&&A(e)}const C=e=>{const t=e.currentTarget,n=E.indexOf(t),a=k[n].value;a!==N&&(j(t),A(a),null!=y&&P(y,String(a)))},T=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var a;const t=E.indexOf(e.currentTarget)+1;n=null!=(a=E[t])?a:E[0];break}case"ArrowLeft":{var r;const t=E.indexOf(e.currentTarget)-1;n=null!=(r=E[t])?r:E[E.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,s.Z)("tabs-container",d)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":u},f)},k.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,key:t,ref:e=>E.push(e),onKeyDown:T,onFocus:C,onClick:C},i,{className:(0,s.Z)("tabs__item",p,null==i?void 0:i.className,{"tabs__item--active":N===t})}),null!=n?n:t)}))),i?(0,r.cloneElement)(v.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},v.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==N})))))}function m(e){const t=(0,i.Z)();return r.createElement(u,(0,a.Z)({key:String(t)},e))}},3721:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var a=n(3117),r=(n(7294),n(3905));n(5488),n(5162);const s={sidebar_label:"Grant Permissions to 3rd parties",sidebar_position:1},i="Grant Permissions to 3rd party addresses",o={unversionedId:"guides/key-manager/give-permissions",id:"guides/key-manager/give-permissions",title:"Grant Permissions to 3rd party addresses",description:"You will need a Universal Profile that you can control via its KeyManager to follow this guide.",source:"@site/docs/guides/key-manager/give-permissions.md",sourceDirName:"guides/key-manager",slug:"/guides/key-manager/give-permissions",permalink:"/guides/key-manager/give-permissions",draft:!1,editUrl:"https://github.com/lukso-network/docs/tree/main/docs/guides/key-manager/give-permissions.md",tags:[],version:"current",lastUpdatedAt:1657785757,formattedLastUpdatedAt:"Jul 14, 2022",sidebarPosition:1,frontMatter:{sidebar_label:"Grant Permissions to 3rd parties",sidebar_position:1},sidebar:"guidesSidebar",previous:{title:"Interact with Contracts",permalink:"/guides/universal-profile/interact-with-contracts"},next:{title:"Get controller addresses",permalink:"/guides/key-manager/get-controllers"}},l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Setup",id:"setup",level:2},{value:"Step 1 - Initialize erc725.js",id:"step-1---initialize-erc725js",level:2},{value:"Step 2 - Encode the permissions",id:"step-2---encode-the-permissions",level:2},{value:"2.1 - create the permission",id:"21---create-the-permission",level:3},{value:"2.2 - encode the permission for the 3rd party address",id:"22---encode-the-permission-for-the-3rd-party-address",level:3},{value:"Step 3 - Add the permissions on your UP",id:"step-3---add-the-permissions-on-your-up",level:2},{value:"3.1 - Load your controller address",id:"31---load-your-controller-address",level:3},{value:"3.2 - Create contract instance",id:"32---create-contract-instance",level:3},{value:"3.3 - Set the permission on the Universal Profile",id:"33---set-the-permission-on-the-universal-profile",level:3},{value:"Final code",id:"final-code",level:2},{value:"Testing the permissions",id:"testing-the-permissions",level:2}],d={toc:c};function p(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"grant-permissions-to-3rd-party-addresses"},"Grant Permissions to 3rd party addresses"),(0,r.kt)("admonition",{title:"Requirements",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You will need a Universal Profile that you can control via its KeyManager to follow this guide. ",(0,r.kt)("br",null),"\nIf you don't have a Universal Profile yet, follow our previous guide ",(0,r.kt)("a",{parentName:"p",href:"/guides/universal-profile/create-profile"},(0,r.kt)("strong",{parentName:"a"},"Create a Universal Profile"))," or look at the ",(0,r.kt)("a",{parentName:"p",href:"/tools/lsp-factoryjs/deployment/universal-profile"},(0,r.kt)("em",{parentName:"a"},"lsp-factory.js"))," docs.")),(0,r.kt)("p",null,"In this guide, we will learn how to grant permissions to third-party addresses to enable them to interact with our Universal Profile. "),(0,r.kt)("p",null,"By the end of this guide, you will know:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"How permissions in the LSP6 Key Manager work + how to create them using ",(0,r.kt)("a",{parentName:"li",href:"../../../../tools/erc725js/getting-started"},(0,r.kt)("em",{parentName:"a"},"erc725.js")),"."),(0,r.kt)("li",{parentName:"ul"},"How to set permissions for a third party ",(0,r.kt)("inlineCode",{parentName:"li"},"address")," on your Universal Profile.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Give permissions to 3rd parties overview",src:n(8559).Z,width:"1794",height:"557"})),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"The Key Manager (KM) enables us to give permissions to other 3rd party addresses to perform certain actions on our Universal Profile (UP), such as editing our profile details, or any other profile metadata."),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"npm install erc725.js @lukso/lsp-smart-contracts\n")),(0,r.kt)("h2",{id:"step-1---initialize-erc725js"},"Step 1 - Initialize erc725.js"),(0,r.kt)("p",null,"The first step is to initialize the erc725.js library with a JSON schema specific to the LSP6 Key Manager. This will enable the library to know how to create and encode the permissions."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const { ERC725 } = require("@erc725/erc725.js");\nconst LSP6Schema = require("@erc725/erc725.js/schemas/LSP6KeyManager.json");\n\n// step 1 -initialize erc725.js with the ERC725Y permissions data keys from LSP6 Key Manager\nconst erc725 = new ERC725(LSP6Schema);\n')),(0,r.kt)("h2",{id:"step-2---encode-the-permissions"},"Step 2 - Encode the permissions"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"More permissions are available in erc725.js. See the API docs for ",(0,r.kt)("a",{parentName:"p",href:"/tools/erc725js/classes/ERC725#encodepermissions"},(0,r.kt)("inlineCode",{parentName:"a"},"encodePermissions(...)"))," function for a complete list.")),(0,r.kt)("p",null,"We can now use erc725.js to create the permissions for a specific 3rd party ",(0,r.kt)("inlineCode",{parentName:"p"},"address"),". The library provide convenience functions for us, such as ",(0,r.kt)("a",{parentName:"p",href:"../../../../tools/erc725js/classes/ERC725#encodepermissions"},(0,r.kt)("inlineCode",{parentName:"a"},"encodePermissions")),"."),(0,r.kt)("h3",{id:"21---create-the-permission"},"2.1 - create the permission"),(0,r.kt)("p",null,"Let's consider in our example that we want to grant the permission ",(0,r.kt)("inlineCode",{parentName:"p"},"SETDATA")," to a ",(0,r.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress"),", so that it can edit our Universal Profile details on our behalf."),(0,r.kt)("p",null,"We can do this very easily with erc725.js, using the ",(0,r.kt)("inlineCode",{parentName:"p"},"encodePermissions(...)")," function."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// step 2.1 - create the permissions of the beneficiary address\nconst beneficiaryPermissions = erc725.encodePermissions({\n    SETDATA: true,\n});\n")),(0,r.kt)("h3",{id:"22---encode-the-permission-for-the-3rd-party-address"},"2.2 - encode the permission for the 3rd party address"),(0,r.kt)("p",null,"Now that we have created the permission value ",(0,r.kt)("inlineCode",{parentName:"p"},"SETDATA"),", we need to assign it to the ",(0,r.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress"),"."),(0,r.kt)("p",null,"To do so, we need to assign the permission value created in step 2.1 to the ",(0,r.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress"),", using the ",(0,r.kt)("inlineCode",{parentName:"p"},"AddressPermissions:Permissions:<address>"),", where ",(0,r.kt)("inlineCode",{parentName:"p"},"<address>")," will be the address of the beneficiary"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// step 2.2 - encode the data key-value pairs of the permissions to be set for the beneficiary address\nconst beneficiaryAddress = "0xcafecafecafecafecafecafecafecafecafecafe"; // EOA address of an exemplary person\nconst permissionData = erc725.encodeData({\n    keyName: "AddressPermissions:Permissions:<address>",\n    dynamicKeyParts: beneficiaryAddress,\n    value: beneficiaryPermissions,\n  });\n')),(0,r.kt)("h2",{id:"step-3---add-the-permissions-on-your-up"},"Step 3 - Add the permissions on your UP"),(0,r.kt)("p",null,"We have now all the data needed to setup the permission for this 3rd party addres on our Universal Profile."),(0,r.kt)("h3",{id:"31---load-your-controller-address"},"3.1 - Load your controller address"),(0,r.kt)("p",null,"We will need to interact with the Key Manager from the main controller address (the externally owned account (EOA) that has all the permissions on the UP)."),(0,r.kt)("p",null,"The first step is to load this main controller address as an EOA using its private key."),(0,r.kt)("p",null,"The private key can be obtained depending on how you created your Universal Profile:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"UP created with our ",(0,r.kt)("strong",{parentName:"li"},"Create a Universal Profile guide"),": you should have provided the private key and known it."),(0,r.kt)("li",{parentName:"ul"},"UP created with the ",(0,r.kt)("em",{parentName:"li"},"lsp-factory.js"),": this is the private key given in the ",(0,r.kt)("inlineCode",{parentName:"li"},"controllerAddresses")," field in the method ",(0,r.kt)("a",{parentName:"li",href:"../../tools/lsp-factoryjs/classes/universal-profile#deploy"},(0,r.kt)("inlineCode",{parentName:"a"},"lspFactory.UniversalProfile.deploy(...)"))),(0,r.kt)("li",{parentName:"ul"},"UP created via the Browser extension: click on the ",(0,r.kt)("em",{parentName:"li"},"Settings")," icon (top right) > and ",(0,r.kt)("em",{parentName:"li"},"Export Private Key"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="Load account from a private key"',title:'"Load',account:!0,from:!0,a:!0,private:!0,'key"':!0},"const Web3 = require('web3');\nconst web3 = new Web3('https://rpc.l14.lukso.network');\n\nconst PRIVATE_KEY = '0x...'; // your EOA private key (previously created)\n\nconst myEOA = web3.eth.accounts.wallet.add(PRIVATE_KEY);\n")),(0,r.kt)("h3",{id:"32---create-contract-instance"},"3.2 - Create contract instance"),(0,r.kt)("p",null,"The next steps is to create the web3 instance of our smart contracts to interact with them. The contract ABIs are available in the @lukso/lsp-smart-contracts npm package."),(0,r.kt)("p",null,"You will need the address of your Universal Profile deployed on L16."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const UniversalProfile = require("@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json");\nconst KeyManager = require("@lukso/lsp-smart-contracts/artifacts/LSP6KeyManager.json");\n\nconst Web3 = require("web3");\n\nconst RPC_ENDPOINT = "https://rpc.l16.lukso.network";\nconst web3 = new Web3(RPC_ENDPOINT);\n\n\n// step 1 - create instance of UniversalProfile and KeyManager contracts\nconst myUniversalProfileAddress = "0x4F81bFDD12c73c94222C7879C91c1B837b8adb62";\nconst myUniversalProfile = new web3.eth.Contract(UniversalProfile.abi, myUniversalProfileAddress);\n')),(0,r.kt)("p",null,"Since the KeyManager is the owner of the Universal Profile, its address can be obtained easily by querying the ",(0,r.kt)("inlineCode",{parentName:"p"},"owner()")," of the Universal Profile."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const keyManagerAddress = await myUniversalProfile.methods.owner().call();\nconst myKeyManager = new web3.eth.Contract(KeyManager.abi, keyManagerAddress);\n")),(0,r.kt)("h3",{id:"33---set-the-permission-on-the-universal-profile"},"3.3 - Set the permission on the Universal Profile"),(0,r.kt)("p",null,"The last and final step is to setup the permissions the ",(0,r.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress")," on our Universal Profile."),(0,r.kt)("p",null,"We can easily access the data key-value pair from the encoded data obtained by erc725.js in step 2.2."),(0,r.kt)("p",null,"We will then encode this permission data keys in a ",(0,r.kt)("inlineCode",{parentName:"p"},"setData(...)")," payload and interact via the Key Manager."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// step 3.3 - encode the payload to set permissions and send the transaction via the Key Manager\nconst payload = myUniversalProfile.methods["setData(bytes32,bytes)"](data.keys[0], data.values[0]).encodeABI();\n\n  // step 4 - send the transaction via the Key Manager contract\n  await myKeyManager.methods.execute(payload).send({\n    from: myEOA.address,\n    gasLimit: 300_000,\n  });\n')),(0,r.kt)("h2",{id:"final-code"},"Final code"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const { ERC725 } = require("@erc725/erc725.js");\nconst LSP6Schema = require("@erc725/erc725.js/schemas/LSP6KeyManager.json");\nconst UniversalProfile = require("@lukso/lsp-smart-contracts/artifacts/UniversalProfile.json");\nconst KeyManager = require("@lukso/lsp-smart-contracts/artifacts/LSP6KeyManager.json");\n\nconst Web3 = require("web3");\n\n// setup\nconst myUniversalProfileAddress = "0x..."; // the address of your Universal Profile on L16\nconst RPC_ENDPOINT = "https://rpc.l16.lukso.network";\n\nconst web3 = new Web3(RPC_ENDPOINT);\nconst erc725 = new ERC725(LSP6Schema);\n\nconst PRIVATE_KEY = "0x..."; // private key of your main controller address\nconst myEOA = web3.eth.accounts.wallet.add(PRIVATE_KEY);\n\nasync function grantPermissions() {\n  // step 1 - create instance of UniversalProfile and KeyManager contracts\n  const myUniversalProfile = new web3.eth.Contract(UniversalProfile.abi, myUniversalProfileAddress);\n\n  const keyManagerAddress = await myUniversalProfile.methods.owner().call();\n  const myKeyManager = new web3.eth.Contract(KeyManager.abi, keyManagerAddress);\n  console.log("keyManagerAddress", keyManagerAddress);\n\n  // step 2 - setup the permissions of the beneficiary address\n  const beneficiaryAddress = "0xcafecafecafecafecafecafecafecafecafecafe"; // EOA address of an exemplary person\n  const beneficiaryPermissions = erc725.encodePermissions({\n    SETDATA: true,\n  });\n\n  // step 3.1 - encode the data key-value pairs of the permissions to be set\n  const data = erc725.encodeData({\n    keyName: "AddressPermissions:Permissions:<address>",\n    dynamicKeyParts: beneficiaryAddress,\n    value: beneficiaryPermissions,\n  });\n\n  console.log(data);\n\n  //   step 3.2 - encode the payload to be sent to the Key Manager contract\n  const payload = myUniversalProfile.methods["setData(bytes32,bytes)"](data.keys[0], data.values[0]).encodeABI();\n\n  // step 4 - send the transaction via the Key Manager contract\n  await myKeyManager.methods.execute(payload).send({\n    from: myEOA.address,\n    gasLimit: 300_000,\n  });\n\n  const result = await myUniversalProfile.methods["getData(bytes32)"](data.keys[0]).call();\n  console.log(\n    `The beneficiary address ${beneficiaryAddress} has now the following permissions:`,\n    erc725.decodePermissions(result)\n  );\n}\n\ngrantPermissions();\n')),(0,r.kt)("h2",{id:"testing-the-permissions"},"Testing the permissions"),(0,r.kt)("p",null,"We can now check that the permissions have been correctly set by querying the ",(0,r.kt)("inlineCode",{parentName:"p"},"AddressPermissions:Permissions:<beneficiaryAddress>")," data key on the ERC725Y storage of the Universal Profile."),(0,r.kt)("p",null,"If everything went well, the code snippet below should return you back an object with the permission ",(0,r.kt)("inlineCode",{parentName:"p"},"SETDATA")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const result = await myUniversalProfile.methods["getData(bytes32)"](data.keys[0]).call();\n  console.log(\n    `The beneficiary address ${beneficiaryAddress} has now the following permissions:`,\n    erc725.decodePermissions(result)\n  );\n')),(0,r.kt)("p",null,"Finally, to test the actual permissions, you can do this guide using a ",(0,r.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress")," that you have control over (created manually via web3.js)."),(0,r.kt)("p",null,"You can then try to do again the ",(0,r.kt)("strong",{parentName:"p"},"Edit our Universal Profile")," guide, using this new 3rd party address that you have control over to test if it can successfull edit the profile details. This will give you guarantee that this ",(0,r.kt)("inlineCode",{parentName:"p"},"beneficiaryAddress")," has the ",(0,r.kt)("inlineCode",{parentName:"p"},"SETDATA")," permission working."))}p.isMDXComponent=!0},8559:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/grant-permissions-to-3rd-parties-overview-400d2da3ffc31c9bb9f55a688ba43b67.jpeg"}}]);